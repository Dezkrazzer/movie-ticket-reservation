<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>CinemaGO - Buy Ticket</title>
    <link rel="icon" th:href="@{/assets/cgoLOGO.png}" type="image/png" />

    <meta property="og:title" content="CinemaGO" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://cgo.lzuardiai.my.id" />
    <meta property="og:image" content="https://cgo.lzuardiai.my.id/assets/cgoLOGO.png" />
    <meta property="og:description" content="CinemaGO is an application for ordering cinema tickets with various features. This application is made using the Java programming language. And the program has met Object Oriented Programming." />
    <meta name="theme-color" content="#c2a900">

    <link rel="stylesheet" th:href="@{/css/buyticket.css}" />
</head>
<body>
    <div class="container-ticket">
    <h1>Detail Film</h1>

    <form th:action="@{/buyticket}" method="post" id="buyTicketForm">
        <input type="hidden" name="movieId" th:value="${movie.movieID}" />
        <input type="hidden" name="selectedSeats" id="selectedSeatsInput" value="" />
        <input type="hidden" name="totalPrice" id="totalPriceInput" value="0" />

    <div class="film-info">
      <div class="film-details">
        <img th:src="${movie.posterFilm}" alt="Poster Film" class="poster" />
        <div class="film-text">
          <h2 th:text="${movie.judulFilm}">Judul Film</h2>
          <div><span class="film-label">Kategori :</span> <span th:text="${movie.categoryFilm}">Story</span> </div>
          <div><span class="film-label">Studio :</span> <span th:text="${movie.auditorium}">1</span> </div>
          <div><span class="film-label">Harga Tiket :</span> Rp<span th:text="${movie.harga}">40.000</span></div>
          <div><span class="film-label">Sinopsis :</span> <span th:text="${movie.sinopsisFilm}">...</span> </div>
          <div class="showtimes">
            <div th:text="${movie.showTime}" class="showtime">10:00</div>
          </div>
        </div>
      </div>
    </div>

    <h3>Pilih Tempat Duduk</h3>
    <div class="screen">LAYAR BIOSKOP</div>
    <div class="seat-map" id="seatMap"></div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-box" style="background-color:#444;"></div> Tersedia
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background-color:#ffd700;"></div> Dipilih
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background-color:#888;"></div> Terisi
      </div>
    </div>


    <div class="order-summary">
      <div class="price-summary">
        <div class="label">TOTAL HARGA</div>
        <div id="totalPrice" class="value">Rp0</div>
      </div>
      <div class="seat-summary">
        <div class="label">TEMPAT DUDUK</div>
        <div id="selectedSeats" class="value">-</div>
      </div>
    </div>

        <button type="submit" class="btn-buy">Beli Tiket</button>
    </form>
  </div>
</body>

<script>
  const seatMap = document.querySelector(".seat-map");
  const rows = ['F','E','D','C','B','A'];
  const cols = 8; 

  for (let row of rows) {
    for (let i = 0; i < cols; i++) {
      if (i === 2 || i === 6) {
        const blank = document.createElement("div");
        blank.className = "seat blank";
        seatMap.appendChild(blank);
      }

      const seat = document.createElement("div");
      seat.className = "seat";
      seat.innerText = `${row}${i + 1}`;
      seatMap.appendChild(seat);
    }
  }

  const seats = document.querySelectorAll(".seat:not(.blank):not(.occupied)");

  seats.forEach(seat => {
    seat.addEventListener("click", function () {
      this.classList.toggle("selected");
      updateSelection();
    });
  });

  function updateSelection() {
    const selectedSeats = document.querySelectorAll(".seat.selected");
    const seatList = [...selectedSeats].map(seat => seat.innerText);
    const totalHarga = seatList.length * 40000;

    // Update teks tampilan
    document.getElementById("selectedSeats").textContent = seatList.join(", ") || "-";
    document.getElementById("totalPrice").textContent = "Rp" + totalHarga.toLocaleString("id-ID");

    // Update nilai input hidden
    document.getElementById("selectedSeatsInput").value = seatList.join(",");
    document.getElementById("totalPriceInput").value = totalHarga;
  }

  // Tangani submit
  document.getElementById("buyTicketForm").addEventListener("submit", function (event) {
    const selectedSeats = document.querySelectorAll(".seat.selected");
    if (selectedSeats.length === 0) {
      event.preventDefault();
      alert("Silakan pilih kursi terlebih dahulu.");
    } else {
      updateSelection(); // pastikan input terisi saat form dikirim
    }
  });
</script>

</html>